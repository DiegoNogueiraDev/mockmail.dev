# HAProxy configuration for MockMail Dashboard
# Add this to your existing /etc/haproxy/haproxy.cfg

# Backend para o dashboard
backend mockmail-dashboard
    balance roundrobin
    option httpchk GET /api/metrics
    server dashboard1 127.0.0.1:3001 check

# Frontend para o dashboard (adicionar às suas configurações existentes)
frontend main
    # ... suas configurações existentes ...
    
    # Dashboard MockMail
    acl is_watch_domain hdr(host) -i watch.mockmail.dev
    use_backend mockmail-dashboard if is_watch_domain

# Se você quiser uma configuração completa separada:
frontend mockmail-watch-frontend
    bind *:80
    bind *:443 ssl crt /path/to/ssl/certificate.pem
    
    # Redirect HTTP to HTTPS
    redirect scheme https if !{ ssl_fc }
    
    # Security headers
    http-response set-header X-Frame-Options SAMEORIGIN
    http-response set-header X-XSS-Protection "1; mode=block"
    http-response set-header X-Content-Type-Options nosniff
    
    # Check if it's the dashboard domain
    acl is_watch_domain hdr(host) -i watch.mockmail.dev
    use_backend mockmail-dashboard if is_watch_domain
    
    # Default backend (redirect to main site if not watch subdomain)
    default_backend mockmail-api

# Backend para API principal (se ainda não existir)
backend mockmail-api
    balance roundrobin
    option httpchk GET /health
    server api1 127.0.0.1:3000 check
